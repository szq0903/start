{include file="Public/head_base" /}

	{include file="Public/menu" /}

	<div class="mainpanel">
    
    {include file="Public/headerbar" /}
        
     <div class="pageheader">
      <h2><i class="fa fa-table"></i> 会员管理 <a class="btn btn-danger" href="{:url('index/members/add')}">添加会员</a></h2>
      <div class="breadcrumb-wrapper">
        <span class="label">当前位置:</span>
        <ol class="breadcrumb">
          <li><a href="/members">会员管理</a></li>
          <li class="active">会员管理</li>
        </ol>
      </div>
    </div>
    
    <div class="contentpanel">
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="panel-btns">
            <a href="" class="panel-close">×</a>
            <a href="" class="minimize">−</a>
          </div>
          <h4 class="panel-title">会员编辑</h4>
         
        </div>
        <div class="panel-body panel-body-nopadding" style="display: block;">
          
          <form method="post" name="myForm" class="form-horizontal form-bordered">
    
            <div class="form-group">
              <label class="col-sm-3 control-label">昵称：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="昵称" name="nickname" value="{if isset($temp['nickname'])}{$temp['nickname']}{/if}" class="form-control">
              </div>
            </div>
            
            <div class="form-group">
				  <label class="col-sm-3 control-label" for="disabledinput">微信openid</label>
				  <div class="col-sm-6">
					 <input type="text" placeholder="微信openid" name="openid" value="{if isset($temp['openid'])}{$temp['openid']}{/if}" class="form-control" readonly>
				  </div>
			</div>
           

            <link href="/template/fileinput/fileinput.css" media="all" rel="stylesheet" type="text/css" />
            <div class="form-group">
				<label class="col-sm-3 control-label">头像：</label>
				<div class="col-sm-6">
					<input id="qcode" name="headimgurl" value="{if isset($temp['headimgurl'])}{$temp['headimgurl']}{/if}" type="hidden">
					<input id="file-zh" name="upqcode" value="{if isset($temp['headimgurl'])}{$temp['headimgurl']}{/if}" type="file" multiple data-min-file-count="1">
				</div>
		  	</div>
           
            <div class="form-group">
              <label class="col-sm-3 control-label">手机号：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="手机号" name="phone" value="{if isset($temp['phone'])}{$temp['phone']}{/if}" class="form-control">
              </div>
            </div>

			  <div class="form-group">
				  <label class="col-sm-3 control-label">营业执照：</label>
				  <div class="col-sm-6">
					  <input id="zj" name="zj" value="{if isset($temp['zj'])}{$temp['zj']}{/if}" type="hidden">
					  <input id="file-zj" name="upzj" value="{if isset($temp['zj'])}{$temp['zj']}{/if}" type="file" multiple data-min-file-count="1">
				  </div>
			  </div>

			  <div class="form-group">
				  <label class="col-sm-3 control-label">审核状态：</label>
				  <div class="col-sm-6">
					  <div class="rdio rdio-success col-sm-3">

						  <input type="radio" name="status" value="1" id="radioSuccess" {if isset($temp['status']) && $temp['status'] == 1}checked{/if}>
						  <label for="radioSuccess">已审核</label>
					  </div>

					  <div class="rdio rdio-danger col-sm-3">
						  <input type="radio" name="status" value="0" id="radioDanger" {if !isset($temp['status']) || $temp['status'] == 0}checked{/if}>
						  <label for="radioDanger">未审核</label>
					  </div>

				  </div>
			  </div>
			  <div class="form-group">
				  <label class="col-sm-3 control-label">余额：</label>
				  <div class="col-sm-6">
					  <input type="text" placeholder="余额" name="money" value="{if isset($temp['money'])}{$temp['money']}{/if}"  class="form-control" {if isset($temp['money']) && $temp['money']>0}readonly{/if}>
				  </div>
			  </div>



             <div class="form-group">
              <label class="col-sm-3 control-label">地区：</label>
              <div class="col-sm-6">
               		<div class="col-sm-3">
					 	<select class="form-control" id="area1">
                  		{volist name="area1" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[1]) && $vo.id==$area[1]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					 </div>
					  	
					 <div class="col-sm-3">
					 	<select class="form-control" id="area2" >
                  		{volist name="area2" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[2]) && $vo.id==$area[2]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
					  	
					  <div class="col-sm-3">
					 	<select class="form-control" id="area3" >
                  		{volist name="area3" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[3]) && $vo.id==$area[3]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
					  <div class="col-sm-3">
					 	<select class="form-control" id="area4" >
                  		{volist name="area4" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[4]) && $vo.id==$area[4]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
					  <input type="hidden" name="aid" value="{if isset($temp['aid'])}{$temp['aid']}{/if}" id="area">
					  <div class="col-sm-12"></div>
				  	  <div class="col-sm-6 help-block"><a class="btn btn-primary" id="addahth">添加地区</a></div>
                <!--<input type="text" placeholder="地区" name="aid" value="{if isset($temp['aid'])}{$temp['aid']}{/if}" class="form-control">-->
              </div>
              
            </div>
            
            
			  <style>
			  	.auth-title {
					border: none;
					border-left: 0.3em #333 solid;
					padding-left: 1em;
				}
				.rules_box {
					border: 1px solid #ccc;
					padding: 10px;
					margin: 10px 0px;
				}
				.rules_close {
					float:right;
				}
			  </style>
            
            <div class="form-group">
             	
              	<label class="col-sm-3 control-label">信息权限：</label>
              	<div class="col-sm-6" id="addahthcom">
              		{if isset($temp.rules)}
              		{volist name="$temp.rules" id="sup" mod="2" }
              		{assign name="var" value="$key" /}
              		<div class="rules_box">
              			<a class="rules_close">×</a>
						<h4 class="auth-title">{$sup['name']}</h4>
						<input type="hidden" name="ahth[{$var}][name]" value="{$sup['name']}">
						<div class="form-group">
							{volist name="sortlist" id="vo" mod="2" }
							{if $vo.parent_id ==0}
							{if $key<>0}
						</div>
						<div class="form-group">
							{/if}
							<h5 class="auth-title">{$vo.name}</h5>
							{else}

							<div class="col-sm-6">
								<label class="control-label">{$vo.name}</label>
							
								<input type="text" name="ahth[{$var}][{$vo.parent_id}][{$vo.id}]" value="{if isset($sup[$vo.parent_id][$vo.id])}{$sup[$vo.parent_id][$vo.id]}{/if}" class="form-control">
							</div>
							{/if}
							{/volist}
						</div>
					</div>
        			{/volist}
         			{/if}
             		
              	</div>
            </div>

 
            <div class="form-group">
				<label class="col-sm-3 control-label" for="disabledinput">添加时间：</label>
				<div class="col-sm-6">
               		<div class="input-group">
                		
                		<input type="text" class="form-control" name="addtime" value="{if isset($temp['addtime'])}{$temp['addtime']}{/if}" placeholder="mm/dd/yyyy" id="datepicker2">
						<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
              		</div>
                	
				</div>
			</div>
            
            <div class="panel-footer" style="display: block;">
				 <div class="row">
					<div class="col-sm-6 col-sm-offset-3">
				
					  <button class="btn btn-primary" type="submit">提交</button>&nbsp;
					  <button class="btn btn-default" type="reset">取消</button>
					</div>
				 </div>
			  </div><!-- panel-footer -->

		  </div>
            
          </form>
          
      </div><!-- panel-body -->
        
        
      <!-- row --> 
    </div><!-- contentpanel -->
    
  </div><!-- mainpanel -->

<script src="/template/js/jquery-1.11.1.min.js"></script>
<script src="/template/js/jquery-migrate-1.2.1.min.js"></script>
<script src="/template/js/bootstrap.min.js"></script>
<script src="/template/js/modernizr.min.js"></script>
<script src="/template/js/jquery.sparkline.min.js"></script>
<script src="/template/js/toggles.min.js"></script>
<script src="/template/js/retina.min.js"></script>
<script src="/template/js/jquery.cookies.js"></script>


<script src="/template/js/jquery-ui-1.10.3.min.js"></script>
<!--<script src="/template/js/select2.min.js"></script>-->

<script src="/template/js/custom.js"></script>

<style>
	.form-control.file-caption.kv-fileinput-caption{
		padding: 7px;
	}
	.form-control.file-caption.kv-fileinput-caption  .file-caption-name
	{
		    line-height: 25px;
	}
</style>
<script src="/template/fileinput/fileinput.js" type="text/javascript"></script>
<script src="/template/fileinput/zh.js" type="text/javascript"></script>

<script>
    jQuery(document).ready(function() {
        
        "use strict";
        
  
        // Date Picker
        jQuery('#datepicker').datepicker();
		jQuery('#datepicker1').datepicker();
		jQuery('#datepicker2').datepicker();
        
		$("#area1").change(function(){
			selectarea(2,$("#area1").val());
		});
		$("#area2").change(function(){
			selectarea(3,$("#area2").val());
		});
		
		$("#area3").change(function(){
			selectarea(4,$("#area3").val());
		});
		
		$("#area4").change(function(){
			$("#area").val($(this).val())
		});
		
		function selectarea(type,supid){
			
			$.get("/magents/getajaxarea/type/"+type+"/supid/"+supid,function(data,status){
				var html='';
				for(var i=0;i<+data.length;i++)
				{
					html +='<option value=\"'+data[i].id+'\">'+data[i].name+'</option>';
				}
				$("#area"+(type)).html(html);
				if(type==2){
					if(html==''){	
						$("#area"+(type+1)).html(html);
						$("#area").val(supid);
					}else{	
						selectarea(3,data[0].id);	
					}
						
				}
				if(type==3)
				{
					if(html==''){	
						$("#area").val(supid)
					}else{	
						$("#area").val([data[0].id])
						selectarea(4,data[0].id)	
					}
				}
				if(type==4)
				{
					if(html==''){	
						$("#area").val(supid)
					}else{	
						$("#area").val([data[0].id])
						//selectarea(3,data[0].id)	
					}
				}
			});
		}
		/*$("#site").change(function(){

			;
			var d = {"site": $(this).val()};
			$.post("{:url('index/websites/ajaxchecksite')}",d,function(result){
				var obj = JSON.parse(result);
				if(obj.status == 1)
				{
					var html='';
					alert(obj.data[0])
					for(var i=0;i<obj.data.length ;i++)
					{
						if(i<3)
						{
							html += obj.data[i]+","
						}
					}
			
					$("#siteinfo").html('有重复的域名:'+html);
					
				}
			});
		});*/
   });
	$('#file-zh').fileinput({
        language: 'zh',
		uploadUrl: '/magents/addimg.html',
        allowedFileExtensions : ['jpg', 'png','gif'],
		previewFileType:'any',
		dropZoneEnabled: false,
		{if isset($temp['headimgurl']) && $temp['headimgurl']<> ''}
		initialPreview: [
			"<img src='{$temp['headimgurl']}'  class='kv-preview-data file-preview-image' style='width:auto;height:160px;'/>",

		],
		initialPreviewConfig:[{caption: "{$temp['headimgurl']}", size: {$temp['imagesize']}, width: "120px",  key: 1},] ,
		initialCaption:'{$temp['headimgurl']}'
		{/if}
		
    }).on("fileuploaded", function (event, data, previewId, index){
			$('#qcode').val(data.response.data);
			$(".file-caption-name").attr("title",data.response.data);
			var html ='<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>'+data.response.data;
			$(".file-caption-name").html(html);
		
	});


    $('#file-zj').fileinput({
        language: 'zh',
        uploadUrl: '/magents/addimg.html',
        allowedFileExtensions : ['jpg', 'png','gif'],
        previewFileType:'any',
        dropZoneEnabled: false,
    {if isset($temp['zj']) && $temp['zj']<> ''}
    initialPreview: [
        "<img src='{$temp['zj']}'  class='kv-preview-data file-preview-image' style='width:auto;height:160px;'/>",

    ],
        initialPreviewConfig:[{caption: "{$temp['zj']}", size: {$temp['zjimagesize']}, width: "120px",  key: 1},] ,
        initialCaption:'{$temp['zj']}'
    {/if}

    }).on("fileuploaded", function (event, data, previewId, index){
        $('#zj').val(data.response.data);
        $(".file-caption-name").attr("title",data.response.data);
        var html ='<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>'+data.response.data;
        $(".file-caption-name").html(html);

    });
	
	$('#addahth').click(function(){
		var name=$("#area4").find("option:selected").text();  
		//获取Select选择的Text
		var id=$("#area4").val();  
		//获取Select选择的Value

		
		
		var html='';
			html +='<div class="rules_box">';
            html +='<a class="rules_close">×</a>';
			html +='<h4 class="auth-title">'+name+'</h4>';
			html +='<input type="hidden" name="ahth['+id+'][name]" value="'+name+'">'
            html +='<div class="form-group">';
					{volist name="sortlist" id="vo" mod="2"}
           			{if $vo.parent_id ==0}
           			{if $key<>0}
           	html +='</div>';
            html +='<div class="form-group">';
            		{/if}
            html +='<h5 class="auth-title">{$vo.name}</h5>';
					{else}
			html +='<div class="col-sm-6">';
			html +='<label class="control-label">{$vo.name}</label>';
			html +='<input type="text" name="ahth['+id+'][{$vo.parent_id}][{$vo.id}]" class="form-control">';
			html +='</div>';
					{/if}
					{/volist}
			html +='</div>';
		$("#addahthcom").append(html);
		//$("#addahthcom").append(2222);
		
	});
	$("#addahthcom").on('click',".rules_close" ,function(){
		$(this).parent('.rules_box').remove();
	});
</script>

</body>
</html>


