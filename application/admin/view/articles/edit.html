{include file="Public/head_base" /}

	{include file="Public/menu" /}

	<div class="mainpanel">
    
    {include file="Public/headerbar" /}
        
     <div class="pageheader">
      <h2><i class="fa fa-table"></i> 文章管理 <a class="btn btn-danger" href="{:url('index/articles/add')}">添加文章</a></h2>
      <div class="breadcrumb-wrapper">
        <span class="label">当前位置:</span>
        <ol class="breadcrumb">
          <li><a href="/articles">文章管理</a></li>
          <li class="active">文章管理</li>
        </ol>
      </div>
    </div>
    
    <div class="contentpanel">
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <div class="panel-btns">
            <a href="" class="panel-close">×</a>
            <a href="" class="minimize">−</a>
          </div>
          <h4 class="panel-title">文章编辑</h4>
         
        </div>
        <div class="panel-body panel-body-nopadding" style="display: block;">
          
          <form method="post" name="myForm" class="form-horizontal form-bordered">
    
            <div class="form-group">
              <label class="col-sm-3 control-label">地区：</label>
              <div class="col-sm-6">
               		<div class="col-sm-3">
					 	<select class="form-control" id="area1">
                  		{volist name="area1" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[1]) && $vo.id==$area[1]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					 </div>
					  	
					 <div class="col-sm-3">
					 	<select class="form-control" id="area2" >
                  		{volist name="area2" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[2]) && $vo.id==$area[2]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
					  	
					  <div class="col-sm-3">
					 	<select class="form-control" id="area3" >
                  		{volist name="area3" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[3]) && $vo.id==$area[3]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
					  <div class="col-sm-3">
					 	<select class="form-control" id="area4" >
                  		{volist name="area4" id="vo"}
                  		<option value="{$vo.id}" {if isset($area[4]) && $vo.id==$area[4]}selected{/if}>{$vo.name}</option>
                  		{/volist}
                		</select>
					  </div>
						<input type="hidden" name="aid" value="{if isset($temp['aid'])}{$temp['aid']}{/if}" id="area">
               
                <!--<input type="text" placeholder="地区" name="aid" value="{if isset($temp['aid'])}{$temp['aid']}{/if}" class="form-control">-->
              </div>
            </div>
            
            <div class="form-group">
				  <label class="col-sm-3 control-label" for="disabledinput">栏目：</label>
				  <div class="col-sm-6">
					 <select class="form-control mb15" id='sid' name="sid">
               
                  		{volist name="psort" id="vo"}
                  		<option value="{$vo.id}" {if isset($temp['sid']) && $vo.id==$temp['sid']}selected{/if}>{$vo.name}</option>
                  		{/volist}
                	</select>
                	<p id="sidinfo" class="text-danger"></p>
				  </div>
			</div>
     
            
            <div class="form-group" style="display: none">
              <label class="col-sm-3 control-label">会员：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="会员" name="mid" value="{if isset($temp['mid'])}{$temp['mid']}{/if}" class="form-control">
              </div>
            </div>
            
            <div class="form-group">
              <label class="col-sm-3 control-label">手机号：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="手机号" name="phone" value="{if isset($temp['phone'])}{$temp['phone']}{/if}" class="form-control">
              </div>
            </div>
            
            
            <link href="/template/fileinput/fileinput.css" media="all" rel="stylesheet" type="text/css" />
            <div class="form-group">
				<label class="col-sm-3 control-label">图片集：</label>
				<div class="col-sm-6">
					<input id="qcode" name="picjson" value="{if isset($temp['picjson'])}{$temp['picjson']}{/if}" type="hidden">
					<input id="file-zh" name="upqcode" value="{if isset($temp['picjson'])}{$temp['picjson']}{/if}" type="file" multiple >
				</div>
		  	</div>
            
            <div class="form-group" id="wechat" {if isset($field['wechat'])}{else}style="display: none;"{/if}>
              <label class="col-sm-3 control-label" id="wechat-title">{if isset($field['wechat'])}{$field['wechat']}{else}微信号{/if}：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="{if isset($field['wechat'])}{$field['wechat']}{else}微信号{/if}" id="wechat" name="wechat" value="{if isset($temp['wechat'])}{$temp['wechat']}{/if}" class="form-control">
                
              </div>
            </div>
            
            <div class="form-group" id='address' {if isset($field['address'])}{else}style="display: none;"{/if}>
              <label class="col-sm-3 control-label" id="address-title">{if isset($field['address'])}{$field['address']}{else}地址{/if}：</label>
              <div class="col-sm-6">
                <input type="text" placeholder="{if isset($field['address'])}{$field['address']}{else}地址{/if}" id="address" name="address" value="{if isset($temp['address'])}{$temp['address']}{/if}" class="form-control">
                <p id="siteinfo" class="text-danger"></p>
              </div>
            </div>
          
            
            <div class="form-group" id="content" {if isset($field['content'])}{else}style="display: none;"{/if}>
              <label class="col-sm-3 control-label" id="content-title">{if isset($field['content'])}{$field['content']}{else}内容{/if}：</label>
              <div class="col-sm-6">
               	<textarea class="form-control" name="content" placeholder="{if isset($field['content'])}{$field['content']}{else}内容{/if}" rows="5">{if isset($temp['content'])}{$temp['content']}{/if}</textarea>
                
              </div>
            </div>
           
            
            
           <div class="form-group">
              <label class="col-sm-3 control-label">状态：</label>
              <div class="col-sm-6">
     
               		<div class="rdio rdio-success col-sm-3">
                       
                        <input type="radio" name="status" value="0" id="radioSuccess" {if $temp['status'] == 0}checked{/if}>
                        <label for="radioSuccess">开启</label>
                    </div>
                      
                	<div class="rdio rdio-danger col-sm-3">
                        <input type="radio" name="status" value="1" id="radioDanger" {if $temp['status'] == 1}checked{/if}>
                        <label for="radioDanger">关闭</label>
                  	</div>
                
              </div>
            </div>
 
            <div class="form-group">
				<label class="col-sm-3 control-label" for="disabledinput">添加时间：</label>
				<div class="col-sm-6">
               		<div class="input-group">
                		
                		<input type="text" class="form-control" name="addtime" value="{if isset($temp['addtime'])}{$temp['addtime']}{/if}" placeholder="mm/dd/yyyy" id="datepicker2">
						<span class="input-group-addon"><i class="fa fa-calendar"></i></span>
              		</div>
                	
				</div>
			</div>
            
            <div class="panel-footer" style="display: block;">
				 <div class="row">
					<div class="col-sm-6 col-sm-offset-3">
				
					  <button class="btn btn-primary" type="submit">提交</button>&nbsp;
					  <button class="btn btn-default" type="reset">取消</button>
					</div>
				 </div>
			  </div><!-- panel-footer -->

		  </div>
            
          </form>
          
      </div><!-- panel-body -->
        
        
      <!-- row --> 
    </div><!-- contentpanel -->
    
  </div><!-- mainpanel -->

<script src="/template/js/jquery-1.11.1.min.js"></script>
<script src="/template/js/jquery-migrate-1.2.1.min.js"></script>
<script src="/template/js/bootstrap.min.js"></script>
<script src="/template/js/modernizr.min.js"></script>
<script src="/template/js/jquery.sparkline.min.js"></script>
<script src="/template/js/toggles.min.js"></script>
<script src="/template/js/retina.min.js"></script>
<script src="/template/js/jquery.cookies.js"></script>


<script src="/template/js/jquery-ui-1.10.3.min.js"></script>
<!--<script src="/template/js/select2.min.js"></script>-->

<script src="/template/js/custom.js"></script>

<style>
	.form-control.file-caption.kv-fileinput-caption{
		padding: 7px;
	}
	.form-control.file-caption.kv-fileinput-caption  .file-caption-name
	{
		    line-height: 25px;
	}
</style>
<script src="/template/fileinput/fileinput.js" type="text/javascript"></script>
<script src="/template/fileinput/zh.js" type="text/javascript"></script>

<script>
    jQuery(document).ready(function() {
        
        "use strict";
        
  
        // Date Picker
        jQuery('#datepicker').datepicker();
		jQuery('#datepicker1').datepicker();
		jQuery('#datepicker2').datepicker();
        
		$("#area1").change(function(){
			selectarea(2,$("#area1").val());
		});
		$("#area2").change(function(){
			selectarea(3,$("#area2").val());
		});
		
		$("#area3").change(function(){
			selectarea(4,$("#area3").val());
		});
		
		$("#area4").change(function(){
			$("#area").val($(this).val())
		});
		
		function selectarea(type,supid){
			
			$.get("/magents/getajaxarea/type/"+type+"/supid/"+supid,function(data,status){
				var html='';
				for(var i=0;i<+data.length;i++)
				{
					html +='<option value=\"'+data[i].id+'\">'+data[i].name+'</option>';
				}
				$("#area"+(type)).html(html);
				if(type==2){
					if(html==''){	
						$("#area"+(type+1)).html(html);
						$("#area").val(supid);
					}else{	
						selectarea(3,data[0].id);	
					}
						
				}
				if(type==3)
				{
					if(html==''){	
						$("#area").val(supid)
					}else{	
						$("#area").val([data[0].id])
						selectarea(4,data[0].id)	
					}
				}
				if(type==4)
				{
					if(html==''){	
						$("#area").val(supid)
					}else{	
						$("#area").val([data[0].id])
						//selectarea(3,data[0].id)	
					}
				}
			});
		}
		$("#sid").change(function(){
			var d = {"sid": $(this).val()};
			$.post("{:url('index/articles/ajaxsorttype')}",d,function(result){
				var obj = JSON.parse(result);
				if(obj.status == 1)
				{
					$("#content").hide();
					$("#wechat").hide();
					$("#address").hide();
					$.each(obj.data,function(name,value) {
						$("#"+name).show();
						$("#"+name+"-title").html(value+"：");
					});
				}else{
					$("#sidinfo").html(obj.msg);
				}
				
			});
		});
   });
	$('#file-zh').fileinput({
        language: 'zh',
		uploadUrl: '/magents/addimg.html',
        allowedFileExtensions : ['jpg', 'png','gif'],
		showUploadedThumbs:true,
		previewFileType:'any',
		dropZoneEnabled: false,
		overwriteInitial: false,
		initialPreviewFileType:'image',//图像是默认的，可以在下面的配置中重写
		purifyHtml:true,//默认情况下会纯化HTML数据以进行预览
		previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
		{if isset($temp['pics'])}
		initialPreview: [
			{volist name="temp['pics']" id="vo" mod="2"}
			"<img src='{$vo['path']}'  class='kv-preview-data file-preview-image' style='width:auto;height:160px;'/>",
			{/volist}
		],
		initialPreviewConfig:[
			{volist name="temp['pics']" id="vo" mod="2"}
			{caption: "{$vo['path']}", size: {$vo['imagesize']}, width: "120px", url: '/magents/delimg.html',  key: {$key+1}, extra: {imgpath: '{$vo['path']}'}},
			{/volist}
		],
		initialCaption:'{$temp['picjson']}'
		{/if}
		
    }).on("fileuploaded", function (event, data, previewId, index){
			var imgs = $('#qcode').val();
			imgs += ","+data.response.data;
			$('#qcode').val(imgs);
			$(".file-caption-name").attr("title",imgs);
			var html ='<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>'+imgs;
			$(".file-caption-name").html(html);
		
	});
	$('#file-zh').on('filepredelete', function(event, key, jqXHR, data) {  
		var str =$('#qcode').val();
		var splitFirst = str.split(','+data.imgpath);
		var result = splitFirst.join('');
		$('#qcode').val(result);
		
		$(".file-caption-name").attr("title",result);
		var html ='<i class=\"glyphicon glyphicon-file kv-caption-icon\"></i>'+result;
		$(".file-caption-name").html(html);
		// console.log('Key = ' + key);  
        // console.log(jqXHR);  
        //console.log(data); 
      });  
</script>

</body>
</html>


